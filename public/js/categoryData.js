'use strict';
var data = [
    {
        dataID: 0,
        imgUrl: "img/product-img/2imv.jpg",
        name: "YG-109-B Style Baby 1",
        rostovka: "8",
        box: "16",
        type: "25-30",
        price: 375,
        full__price: 1230,
        rostovka__price: 600,
        real_id: 0,
        product_url: 'product_inner'
    },
    {
        dataID: 1,
        imgUrl: "img/product-img/21imv.jpg",
        name: "M-165 Clibee 2",
        rostovka: "8",
        box: "16",
        type: "31-36",
        price: 175,
        full__price: 1630,
        rostovka__price: 800,
        real_id: 1,
        product_url: 'product_inner'
    },
    {
        dataID: 2,
        imgUrl: "img/product-img/22imv.jpg",
        name: "M-31-1 Clibee 3",
        rostovka: "16",
        box: "61",
        type: "26-30",
        price: 230,
        full__price: 2230,
        rostovka__price: 1150,
        real_id: 2,
        product_url: 'product_inner'
    },
    {
        dataID: 3,
        imgUrl: "img/product-img/23imv.jpg",
        name: "M-05 Style Clibee 4",
        rostovka: "5",
        box: "5",
        type: "26-30",
        price: 210,
        full__price: 3230,
        rostovka__price: 1615,
        real_id: 3,
        product_url: 'product_inner'
    },
    {
        dataID: 4,
        imgUrl: "img/product-img/24imv.jpg",
        name: "CQ-23-pink Style Baby 5",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 370,
        full__price: 7830,
        rostovka__price: 3415,
        real_id: 4,
        product_url: 'product_inner'
    },
    {
        dataID: 5,
        imgUrl: "img/product-img/25imv.jpg",
        name: "CQ-23-pink Style Baby 6",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 380,
        full__price: 4230,
        rostovka__price: 2115,
        real_id: 5,
        product_url: 'product_inner'
    },
    {
        dataID: 6,
        imgUrl: "img/product-img/26imv.jpg",
        name: "CQ-23-pink Style Baby 7",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 390,
        full__price: 4630,
        rostovka__price: 2315,
        real_id: 6,
        product_url: 'product_inner'
    },
    {
        dataID: 7,
        imgUrl: "img/product-img/27imv.jpg",
        name: "CQ-23-pink Style Baby 8",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 400,
        full__price: 5230,
        rostovka__price: 2115,
        real_id: 7,
        product_url: 'product_inner'
    },
    {
        dataID: 8,
        imgUrl: "img/product-img/prod1.jpg",
        name: "CQ-23-pink Style Baby 9",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 410,
        full__price: 6230,
        rostovka__price: 3115,
        real_id: 8,
        product_url: 'product_inner'
    },
    {
        dataID: 9,
        imgUrl: "img/product-img/prod2.jpg",
        name: "CQ-23-pink Style Baby 10",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 10,
        imgUrl: "img/product-img/imgs7.jpg",
        name: "CQ-23-pink Style Baby 11",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 11,
        imgUrl: "img/product-img/imgs1.jpg",
        name: "CQ-23-pink Style Baby 12",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 12,
        imgUrl: "img/product-img/imgs3.jpg",
        name: "CQ-23-pink Style Baby 13",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 13,
        imgUrl: "img/product-img/imgs5.jpg",
        name: "CQ-23-pink Style Baby 14",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 14,
        imgUrl: "img/product-img/imgs8.jpg",
        name: "CQ-23-pink Style Baby 15",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 15,
        imgUrl: "img/product-img/imgs9.jpg",
        name: "CQ-23-pink Style Baby 16",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 16,
        imgUrl: "img/product-img/prod2.jpg",
        name: "CQ-23-pink Style Baby 17",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 17,
        imgUrl: "img/product-img/imgs13.jpg",
        name: "CQ-23-pink Style Baby 18",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 18,
        imgUrl: "img/product-img/imgs1.jpg",
        name: "CQ-23-pink Style Baby 19",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 19,
        imgUrl: "img/product-img/imgs3.jpg",
        name: "CQ-23-pink Style Baby 20",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 20,
        imgUrl: "img/product-img/imgs4.jpg",
        name: "CQ-23-pink Style Baby 21",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 21,
        imgUrl: "img/product-img/imgs5.jpg",
        name: "CQ-23-pink Style Baby 22",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 22,
        imgUrl: "img/product-img/imgs7.jpg",
        name: "CQ-23-pink Style Baby 23",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 23,
        imgUrl: "img/product-img/imgs7.jpg",
        name: "CQ-23-pink Style Baby 24",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 24,
        imgUrl: "img/product-img/imgs8.jpg",
        name: "CQ-23-pink Style Baby 25",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 25,
        imgUrl: "img/product-img/imgs9.jpg",
        name: "CQ-23-pink Style Baby 26",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 26,
        imgUrl: "img/product-img/imgs10.jpg",
        name: "CQ-23-pink Style Baby 27",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 27,
        imgUrl: "img/product-img/imgs11.jpg",
        name: "CQ-23-pink Style Baby 28",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 28,
        imgUrl: "img/product-img/imgs12.jpg",
        name: "CQ-23-pink Style Baby 29",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 29,
        imgUrl: "img/product-img/imgs13.jpg",
        name: "CQ-23-pink Style Baby 30",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 30,
        imgUrl: "img/product-img/imgs12.jpg",
        name: "CQ-23-pink Style Baby 31",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 31,
        imgUrl: "img/product-img/imgs11.jpg",
        name: "CQ-23-pink Style Baby 32",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 32,
        imgUrl: "img/product-img/imgs10.jpg",
        name: "CQ-23-pink Style Baby 33",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 33,
        imgUrl: "img/product-img/imgs3.jpg",
        name: "CQ-23-pink Style Baby 34",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 34,
        imgUrl: "img/product-img/imgs7.jpg",
        name: "CQ-23-pink Style Baby 35",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 35,
        imgUrl: "img/product-img/imgs8.jpg",
        name: "CQ-23-pink Style Baby 36",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 36,
        imgUrl: "img/product-img/imgs4.jpg",
        name: "CQ-23-pink Style Baby 37",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 37,
        imgUrl: "img/product-img/imgs9.jpg",
        name: "CQ-23-pink Style Baby 38",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 38,
        imgUrl: "img/product-img/imgs10.jpg",
        name: "CQ-23-pink Style Baby 39",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 39,
        imgUrl: "img/product-img/imgs11.jpg",
        name: "CQ-23-pink Style Baby 40",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    },{
        dataID: 40,
        imgUrl: "img/product-img/prod2.jpg",
        name: "CQ-23-pink Style Baby 41",
        rostovka: "6",
        box: "6",
        type: "25-30",
        price: 420,
        full__price: 9230,
        rostovka__price: 4115,
        real_id: 9,
        product_url: 'product_inner'
    }
], productTheme = $('#template');

//work with pagination
var Pagination = {
    code: '',
    Extend: function(data) {
        data = data || {};
        Pagination.size = data.size || 9999;
        Pagination.page = data.page || 1;
        Pagination.step = data.step || 10;
    },

    Add: function(s, f) {
        for (var i = s; i < f; i++) {
            Pagination.code += '<a>' + i + '</a>';
        }
    },

    Last: function() {
        Pagination.code += '<i>...</i><a>' + Pagination.size + '</a>';
    },

    First: function() {
        Pagination.code += '<a>1</a><i>...</i>';
    },

    Click: function() {
        Pagination.page = +this.innerHTML;
        Pagination.Start();
    },

    Prev: function() {
        Pagination.page--;
        if (Pagination.page < 1) {
            Pagination.page = 1;
        }
        Pagination.Start();
        scrolltop();
    },

    Next: function() {
        Pagination.page++;
        if (Pagination.page > Pagination.size) {
            Pagination.page = Pagination.size;
        }
        Pagination.Start();
        scrolltop();
    },

    First_Page: function () {
        Pagination.page = 1;
        if (Pagination.page < 1) {
            Pagination.page = 1;
        }
        Pagination.Start();
        scrolltop();
    },

    Last_Page: function () {
        Pagination.page = Pagination.size;
        if (Pagination.page < 1) {
            Pagination.page = 1;
        }
        Pagination.Start();
        scrolltop();
    },

    Bind: function() {
        var a = Pagination.e.getElementsByTagName('a');
        for (var i = 0; i < a.length; i++) {
            if (+a[i].innerHTML === Pagination.page) a[i].className = 'current';
            a[i].addEventListener('click', Pagination.Click, false);
            scrolltop();
        }
    },

    Finish: function() {
        Pagination.e.innerHTML = Pagination.code;
        Pagination.code = '';
        Pagination.Bind();
    },

    Start: function() {
        if (Pagination.size < Pagination.step * 2 + 6) {
            Pagination.Add(1, Pagination.size + 1);
        }
        else if (Pagination.page < Pagination.step * 2 + 1) {
            Pagination.Add(1, Pagination.step * 2 + 4);
            Pagination.Last();
        }
        else if (Pagination.page > Pagination.size - Pagination.step * 2) {
            Pagination.First();
            Pagination.Add(Pagination.size - Pagination.step * 2 - 2, Pagination.size + 1);
        }
        else {
            Pagination.First();
            Pagination.Add(Pagination.page - Pagination.step, Pagination.page + Pagination.step + 1);
            Pagination.Last();
        }
        Pagination.Finish();

        var pageNum = Pagination.page;
        nextPage(pageNum);
    },

    Buttons: function(e) {
        var nav = e.getElementsByTagName('a');
        nav[0].addEventListener('click', Pagination.Prev, false);
        nav[1].addEventListener('click', Pagination.Next, false);
    },

    Create: function(e) {
        var html = [
            '<div class="moveTo_start scrollUp" onclick="Pagination.First_Page()"><i class="fa fa-angle-double-left"></i></div>',
            '<a class="previous_Item scrollUp">← предыдущая</a>',
            '<span class="paginationItems scrollUp"></span>',
            '<a class="next_Item scrollUp">следующая →</a>',
            '<div class="moveTo_end scrollUp" onclick="Pagination.Last_Page()"><i class="fa fa-angle-double-right"></i></div>'
        ];

        e.innerHTML = html.join('');
        Pagination.e = e.getElementsByTagName('span')[0];
        Pagination.Buttons(e);
    },

    Init: function(e, data) {
        Pagination.Extend(data);
        Pagination.Create(e);
        Pagination.Start();
    }
};

var numberPerPage = 12, pageList = [], currentPage = 1, numberOfPages = 0;

$(document).on('click', '.nice-select-box .list', function () {
    numberPerPage = Number ($.find('.nice-select-box .option.selected')[1].dataset.value);
    pageList = []; currentPage = 1; numberOfPages = 0;
    makePagination();
    loadList();
    init();
});

function load() {
    makePagination();
    loadList();
}
load();

/// Work with Data
function makePagination() {
    numberOfPages = getNumberOfPages();
}

function getNumberOfPages() {
    return Math.ceil(data.length / numberPerPage);
}

function nextPage(pageNum) {
    currentPage = pageNum;
    loadList();
}

function loadList() {
    var begin = ((currentPage - 1) * numberPerPage);
    var end = begin + numberPerPage;

    pageList = data.slice(begin, end);
    drawItems();
}

function drawItems() {
    var delay = 0;
    document.getElementById("target").innerHTML = "";

    $(productTheme).tmpl(pageList).appendTo('#target').each(function () {
        delay += 0.1;
        $(this).addClass('animated fadeIn').css('animation-delay', delay + 's');
    });
}


function scrolltop() {
    var body = $("html, body");
    body.stop().animate({scrollTop:0}, 500, 'swing');
}

//Initialization

var init = function() {
    Pagination.Init(document.getElementById('pagination'), {
        size: numberOfPages,
        page: 1,
        step: 3
    });
};

init();


///work with filters
var values = [], targetID = 0;

$('.sidebar-container input[type=checkbox]').on('change', function(){
    var target = $(this)[0].parentNode.parentNode.parentNode;
    targetID = $(this)[0].parentNode.childNodes[1].id;

    if($(this).is(':checked')) {
        values.push([targetID, $(this)[0].defaultValue, $(target)[0].childNodes[1].dataset.id]);
    }


    if(values.length !== 0){
        var AppendedList = $('.choosedFilter li');
        $('.CFBlock').css('display', 'block');

        Number (AppendedList.length++);
        for (var y = 0; y < values.length; y++) {
            for(var z = 0; z < AppendedList.length; z++){
                if($(this)[0].id === values[y][z]){
                    $(AppendedList)[z].remove();
                }
            }

            $('.choosedFilter').append('' +
                '<li class="appedned__item">' +
                '<span class="item" data-type="'+ values[y][0] +'">'+ values[y][1] +'</span>' +
                '<i class="fa fa-times-circle removeAppended__Item" aria-hidden="true"></i>' +
                '</li>');
        }
        RemoveItem();
    }

    if($(this).is(':not(:checked)')) {
        var unchecked = $(this)[0].parentNode.childNodes[1].defaultValue,
            AppendedLength = $('.choosedFilter li');

        for (var i = 0; i < values.length; i++) {
            if (unchecked === values[i][1]) {
                for (var k = 0; k < AppendedLength.length; k++){
                    if(AppendedLength[k].innerText === values[i][1]){
                        AppendedLength[k].remove()
                    }
                }
                values.splice(i, 1);
            }
        }
    }

    if(values.length === 0) {
        $('.CFBlock').css('display', 'none');
    }
});

function RemoveItem() {
    $('.removeAppended__Item').on('click', function () {
        var clickedTarget = $(this)[0].parentElement.textContent,
            AppendedList = $('.filterInner input');

        $(this)[0].parentElement.remove();

        for (var y = 0; y < values.length; y++){
            if(clickedTarget === values[y][1]){
                console.log('asda' + values.splice(y, 1))
            }
        }


        for (var i = 0; i < AppendedList.length; i++){
            if(AppendedList[i].defaultValue === clickedTarget){
                AppendedList[i].checked = false;
            }
        }

        if(values.length === 0){
            $('.CFBlock').css('display', 'none');
        }
    });
}

$('.removeallFilters span').on('click', function () {
    values = [];
    var AppendedList = $('.choosedFilter li');

    for (var i = 0; i < AppendedList.length; i++){
        $(AppendedList)[i].remove();
    }

    if(values.length === 0){
        $('.CFBlock').css('display', 'none');
    }

    $('input[type=checkbox]').prop('checked', false);

});

$('.submit_onChoose button').on('click', function () {
    values = [];
    $('.submit_onChoose').removeClass('showed');
    $('input[type=checkbox]').prop('checked', false)
});